<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        JVM 性能监控和故障处理工具 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/" />
        </div>
        <div class="name">
            <i>Liam Chen</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#jps-JVM-Process-Status-Tool"><span class="toc-text">jps (JVM Process Status Tool)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#显示指定系统中的所有虚拟机进程"><span class="toc-text">显示指定系统中的所有虚拟机进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注意"><span class="toc-text">[ 注意 ]</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#不管使用-root-用户权限还是-普通用户权限都不能执行-jps-指令"><span class="toc-text">不管使用 root 用户权限还是 普通用户权限都不能执行 jps 指令</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#上述问题解决方案"><span class="toc-text">上述问题解决方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jstat-JVM-Statistics-Monitoring-Tool"><span class="toc-text">jstat (JVM Statistics Monitoring Tool)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jinfo-Configuration-Info-for-java"><span class="toc-text">jinfo (Configuration Info for java)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#实时查询和调整虚拟机各项参数"><span class="toc-text">实时查询和调整虚拟机各项参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jmap-Memory-Map-for-Java"><span class="toc-text">jmap (Memory Map for Java)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#生成对存储快照"><span class="toc-text">生成对存储快照</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jhat-JVM-Heap-Analysis-Tool"><span class="toc-text">jhat (JVM Heap Analysis Tool)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#与jmap搭配使用，-来分析-jmap-生成的-堆存储快照文件"><span class="toc-text">与jmap搭配使用， 来分析 jmap 生成的 堆存储快照文件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#注意-分析工作比较消耗资源，可将dump-文件复制到其他机器上分析"><span class="toc-text">[ 注意 ] : 分析工作比较消耗资源，可将dump 文件复制到其他机器上分析</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jstack-Stack-Trace-for-Java"><span class="toc-text">jstack (Stack Trace for Java)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#生成JVM-当前时刻的线程快照"><span class="toc-text">生成JVM 当前时刻的线程快照</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        JVM 性能监控和故障处理工具
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2018-07-28 23:52:35</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#java" title="java">java</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h3 id="jps-JVM-Process-Status-Tool"><a href="#jps-JVM-Process-Status-Tool" class="headerlink" title="jps (JVM Process Status Tool)"></a>jps (JVM Process Status Tool)</h3><h4 id="显示指定系统中的所有虚拟机进程"><a href="#显示指定系统中的所有虚拟机进程" class="headerlink" title="显示指定系统中的所有虚拟机进程"></a>显示指定系统中的所有虚拟机进程</h4><pre><code>&gt; jps [ options ] [ hostid ]
</code></pre><p><img src="/assets/picture/jps_help.png" alt="图片" title="JPS 指令说明"></p>
<p>jps 选项 [ options ] 说明：<br><br>-q 只输出LVMID 省略主类的名称；<br><br>-m 输出虚拟机进程启东市传递给主类main函数的参数；<br><br>-l 输出主类的名称，如果进程执行的是jar包，输出jar 路径；<br><br>-v 输出虚拟机进程启动时的JVM 参数</p>
<h4 id="注意"><a href="#注意" class="headerlink" title="[ 注意 ]"></a>[ 注意 ]</h4><p>使用 jps 指令得到的输出结果可能是下面这样的</p>
<pre><code>pid -- process information unavailable
</code></pre><p>JVM 会在本地文件系统中的 tmp 文件夹中新建 <code>hsperfdata_{username}/{pid}</code> 文件， 如果当前执行 jps 指令的用户没有属于自己的这个文件，就会出现这种提示</p>
<p>例如： 我们公司tomcat 的启动用户默认是 <code>tomcat</code>,  JVM 新建的文件是 <code>/tmp/hsperfdata_tomcat/pid</code>(这是在linux系统中)，这样导致了如下问题</p>
<h6 id="不管使用-root-用户权限还是-普通用户权限都不能执行-jps-指令"><a href="#不管使用-root-用户权限还是-普通用户权限都不能执行-jps-指令" class="headerlink" title="不管使用 root 用户权限还是 普通用户权限都不能执行 jps 指令"></a>不管使用 root 用户权限还是 普通用户权限都不能执行 jps 指令</h6><h5 id="上述问题解决方案"><a href="#上述问题解决方案" class="headerlink" title="上述问题解决方案"></a>上述问题解决方案</h5><pre><code>sudo -u tomcat jps pid
</code></pre><hr>
<h3 id="jstat-JVM-Statistics-Monitoring-Tool"><a href="#jstat-JVM-Statistics-Monitoring-Tool" class="headerlink" title="jstat (JVM Statistics Monitoring Tool)"></a>jstat (JVM Statistics Monitoring Tool)</h3><pre><code>&gt; jstat [ option vmid [interval [s|ms] [count]]  ]
</code></pre><p>参数  <code>interval</code>, <code>count</code> 代表查询的间隔时间和次数，如果省略这两个参数表示只查询一次<br>假设需要每 1s 查询一次进程 3234 的jvm gc信息，一共查询10次</p>
<pre><code>&gt; jstat -gc 3234 1s 10
</code></pre><table>
<thead>
<tr>
<th style="text-align:left">选项</th>
<th>作用描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-class</td>
<td>监视类装载、卸载数量、总空间以及类装载所耗费的时间</td>
</tr>
<tr>
<td style="text-align:left">-gc</td>
<td>监视 JVM 堆状况，包括 Eden区、两个survivor 区、老年代、永生代等的容量、已用空间、GC时间合计等信息</td>
</tr>
<tr>
<td style="text-align:left">-gccapacity</td>
<td>监视内容与 -gc 基本相同，但输出主要关注java 堆各个区域使用到的最大、最小空间</td>
</tr>
<tr>
<td style="text-align:left">-gcutil</td>
<td>监视内容与 -gc 基本相同，但输出主要关注已经使用空间占总空间的百分比</td>
</tr>
<tr>
<td style="text-align:left">-gccause</td>
<td>与 -gcutil 功能一样，但是会额外输出导致上一次 GC 产生的原因</td>
</tr>
<tr>
<td style="text-align:left">-gcnew</td>
<td>监视新生代 gc 状况</td>
</tr>
<tr>
<td style="text-align:left">-gcnewcapacity</td>
<td>监视内容与 -gcnew 基本相同，但输出主要关注新生代已经使用到的最大、最小空间</td>
</tr>
<tr>
<td style="text-align:left">-gcold</td>
<td>监视老年代 gc 状况</td>
</tr>
<tr>
<td style="text-align:left">-gcoldcapacity</td>
<td>监视内容与 -gcold 基本相同，但输出主要关注老年代已经使用到的最大、最小空间</td>
</tr>
<tr>
<td style="text-align:left">-gcpermcapacity</td>
<td>输出永久代已经使用到的最大、最小空间</td>
</tr>
<tr>
<td style="text-align:left">-compiler</td>
<td>输出JIT 编译器编译过的方法、耗时等信息</td>
</tr>
<tr>
<td style="text-align:left">-gccompilation</td>
<td>输出已经呗 JIT 编译的方法</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="jinfo-Configuration-Info-for-java"><a href="#jinfo-Configuration-Info-for-java" class="headerlink" title="jinfo (Configuration Info for java)"></a>jinfo (Configuration Info for java)</h3><h4 id="实时查询和调整虚拟机各项参数"><a href="#实时查询和调整虚拟机各项参数" class="headerlink" title="实时查询和调整虚拟机各项参数"></a>实时查询和调整虚拟机各项参数</h4><pre><code>&gt; jinfo [ option ] pid

liam@liamchen-ubuntu:~$ jinfo -help
Usage:
    jinfo [option] &lt;pid&gt;
        (to connect to running process)
    jinfo [option] &lt;executable &lt;core&gt;
        (to connect to a core file)
    jinfo [option] [server_id@]&lt;remote server IP or hostname&gt;
        (to connect to remote debug server)

where &lt;option&gt; is one of:
    -flag &lt;name&gt;         to print the value of the named VM flag
    -flag [+|-]&lt;name&gt;    to enable or disable the named VM flag
    -flag &lt;name&gt;=&lt;value&gt; to set the named VM flag to the given value
    -flags               to print VM flags
    -sysprops            to print Java system properties
    &lt;no option&gt;          to print both of the above
    -h | -help           to print this help message
</code></pre><hr>
<h3 id="jmap-Memory-Map-for-Java"><a href="#jmap-Memory-Map-for-Java" class="headerlink" title="jmap (Memory Map for Java)"></a>jmap (Memory Map for Java)</h3><h4 id="生成对存储快照"><a href="#生成对存储快照" class="headerlink" title="生成对存储快照"></a>生成对存储快照</h4><pre><code>&gt; jmap [ option ] vmid
</code></pre><table>
<thead>
<tr>
<th style="text-align:left">选项</th>
<th>作用描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-dump</td>
<td>生成 JVM 堆存储快照。 格式为: dump:[live,]format=b,file=<filename>，其中live参数说明是否只dump 出存活的对象</filename></td>
</tr>
<tr>
<td style="text-align:left">-finalizeinfo</td>
<td>显示在F-Queue 中等待Finalizer线程执行 finalize 方法的对象，只在 linux/solaris 平台下有效</td>
</tr>
<tr>
<td style="text-align:left">-heap</td>
<td>显示 JVM 堆详细信息，如使用那种回收器、参数配置、分代情况等。只在 linux/solaris 平台下有效</td>
</tr>
<tr>
<td style="text-align:left">-histo</td>
<td>显示堆中对象统计信息，包括类、实例数量、合计数量</td>
</tr>
<tr>
<td style="text-align:left">-permstat</td>
<td>以ClassLoader为统计口径，显示永生代内存状态，只在 linux/solaris 平台下有效</td>
</tr>
<tr>
<td style="text-align:left">-F</td>
<td>当 JVM 进程对 -dump 指令选项没有响应时，可使用这个选项强制生成dump 快照，只在 linux/solaris 平台下有效</td>
</tr>
</tbody>
</table>
<pre><code>使用示例：
&gt; jmap -dump:format=b,file=test.dump pid
</code></pre><hr>
<h3 id="jhat-JVM-Heap-Analysis-Tool"><a href="#jhat-JVM-Heap-Analysis-Tool" class="headerlink" title="jhat (JVM Heap Analysis Tool)"></a>jhat (JVM Heap Analysis Tool)</h3><h4 id="与jmap搭配使用，-来分析-jmap-生成的-堆存储快照文件"><a href="#与jmap搭配使用，-来分析-jmap-生成的-堆存储快照文件" class="headerlink" title="与jmap搭配使用， 来分析 jmap 生成的 堆存储快照文件"></a>与jmap搭配使用， 来分析 jmap 生成的 堆存储快照文件</h4><pre><code>&gt; jhat test.dump
</code></pre><p>当屏幕上出现 “Server is ready” 提示后，访问 <code>http://localhost:7000</code> 就能看到分析结果</p>
<h6 id="注意-分析工作比较消耗资源，可将dump-文件复制到其他机器上分析"><a href="#注意-分析工作比较消耗资源，可将dump-文件复制到其他机器上分析" class="headerlink" title="[ 注意 ] : 分析工作比较消耗资源，可将dump 文件复制到其他机器上分析"></a>[ 注意 ] : 分析工作比较消耗资源，可将dump 文件复制到其他机器上分析</h6><hr>
<h3 id="jstack-Stack-Trace-for-Java"><a href="#jstack-Stack-Trace-for-Java" class="headerlink" title="jstack (Stack Trace for Java)"></a>jstack (Stack Trace for Java)</h3><h4 id="生成JVM-当前时刻的线程快照"><a href="#生成JVM-当前时刻的线程快照" class="headerlink" title="生成JVM 当前时刻的线程快照"></a>生成JVM 当前时刻的线程快照</h4><pre><code>&gt; jstack [ option ] vmid
</code></pre><table>
<thead>
<tr>
<th style="text-align:left">选项</th>
<th>作用描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-l</td>
<td>除堆栈外，显示关于锁的附加信息</td>
</tr>
<tr>
<td style="text-align:left">-m</td>
<td>打印</td>
</tr>
<tr>
<td style="text-align:left">-F</td>
<td>当 JVM 进程对指令没有响应时，可使用这个选项强制生成 threaddump 快照，只在 linux/solaris 平台下有效</td>
</tr>
</tbody>
</table>

        
        <div id="comment-container">
        </div>
    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</html>
