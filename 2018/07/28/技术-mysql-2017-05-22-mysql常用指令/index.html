<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        mysql常用指令 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/" />
        </div>
        <div class="name">
            <i>Liam Chen</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#执行-sql-文件"><span class="toc-text">执行 .sql 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-查看-binlog"><span class="toc-text">mysql 查看 binlog</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#待解决问题"><span class="toc-text">待解决问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-查看存储过程"><span class="toc-text">mysql 查看存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看存储过程状态"><span class="toc-text">查看存储过程状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看存储过程具体定义"><span class="toc-text">查看存储过程具体定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除存储过程"><span class="toc-text">删除存储过程</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        mysql常用指令
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2018-07-28 23:52:35</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#mysql" title="mysql">mysql</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h3 id="执行-sql-文件"><a href="#执行-sql-文件" class="headerlink" title="执行 .sql 文件"></a>执行 <code>.sql</code> 文件</h3><p><em>方法1</em></p>
<pre><code>mysql -h1.1.1.1 -P3306 -uadmin -ppwd db_name &lt; test.sql
</code></pre><p><em>方法2</em></p>
<ol>
<li>使用 <code>mysql-client</code> 登录到 mysql 服务器</li>
<li>source /root/path/to/.sql</li>
</ol>
<h3 id="mysql-查看-binlog"><a href="#mysql-查看-binlog" class="headerlink" title="mysql 查看 binlog"></a>mysql 查看 binlog</h3><p><code>mysql</code> 提供了 <code>mysqlbinlog</code> 指令，用于查看binlog</p>
<p>先来一个小例子, 查看某一段时间的 bin log</p>
<pre><code>mysqlbinlog -h[host]  -P[port] -u[username] -p[password] --read-from-remote-server [binlog file name]
--base64-output=decode-rows --start-datetime=&apos;2017-11-02 00:00:00&apos;
--stop-datetime=&apos;2017-11-02 00:10:00&apos;
</code></pre><p>看了上面这个小例子，发现一个小问题: <em><em>binlog file name 从哪来？</em></em><br>这个需要我们去mysql中去查看</p>
<pre><code>mysql&gt; mysql -u[username] -p[password]    ## 登录mysql
mysql&gt; show variables like &apos;log_bin&apos;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| log_bin       | OFF   | # 这个参数说明当前mysql 没有开启binlog 日志
+---------------+-------+
</code></pre><p>这里又引入一个问题: <em><em>如何开启 mysql 的 binlog</em></em></p>
<p>在 <code>mysql</code> 的 <code>官方文档</code> 中，对于 <code>binlog</code> 的开启只有一段内容</p>
<pre><code>Binary logging is enabled by default (the log_bin system variable is set to ON). The exception is if you use mysqld to initialize the data directory manually by invoking it with the --initialize or --initialize-insecure option, when binary logging is disabled by default, but can be enabled by specifying the --log-bin option.
二进制日志是默认启用（系统变量log_bin默认设置为ON）。唯一的例外是如果你使用mysqld来初始化数据目录手动调用它的 --initialize 或 --initialize-insecure 选项，当二进制日志默认是禁用的，但可以通过指定 `--log-bin` 选项启用。
</code></pre><p>我们开始设置 <code>mysql</code> 的启动配置， 这里有两种方式</p>
<ol>
<li><p>直接在启动命令行中添加参数</p>
<pre><code>sudo /usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --log-bin=mysql-bin --user=\_mysql
</code></pre></li>
<li><p>在 mysql 配置文件中增加配置信息<br>这个时候我们遇到一个问题: Mysql 的配置文件在哪？</p>
<pre><code>&gt; sudo mysqld --verbose --help | grep -A2 &quot;Default options are read from the following files in the given order:&quot;
Default options are read from the following files in the given order:
/etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf
</code></pre></li>
</ol>
<p>从上面可以看到 <code>mysql</code> 的配置文件如下：</p>
<pre><code>/etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf
</code></pre><p>在 <code>/etc/my.cnf</code> 添加配置如下</p>
<pre><code>[mysqld]
basedir=/usr/local/mysql
datadir=/usr/local/mysql/data
plugin-dir=/usr/local/mysql/lib/plugin
user=\_mysql
log-bin=mysql-bin
port=3306
</code></pre><p>我们来尝试启动 <code>mysql</code>，但是却没能启动成功， 报错信息如下</p>
<pre><code>[ERROR] You have enabled the binary log, but you haven&apos;t provided the mandatory server-id. Please refer to the proper server start-up parameters documentation
</code></pre><p>遇到问题，我们再去看看官方文档，在官方文档中有如下介绍，在 mysql 5.7 及以上版本中，需要设置参数 <code>server-id</code></p>
<pre><code>In MySQL 5.7, a server ID had to be specified when binary logging was enabled, or the server would not start. The server_id system variable is set to 1 by default. The server can be started with this default ID when binary logging is enabled, but a warning message is issued if you do not specify a server ID explicitly using the --server-id option. For servers that are used in a replication topology, you must specify a unique non-zero server ID for each server.
在MySQL 5.7中，当启用二进制日志时，必须指定服务器ID，否则服务器将无法启动。系统变量 server_id 默认设置为1。当启用二进制日志记录时，服务器可以以这个默认ID启动，但如果未显式使用服务器ID选项指定服务器ID，则会发出警告消息。对于复制拓扑中使用的服务器，必须为每个服务器指定唯一的非零服务器ID。
</code></pre><p>将 <code>/etc/my.cnf</code> 配置修改如下：</p>
<pre><code>[mysqld]
basedir=/usr/local/mysql
datadir=/usr/local/mysql/data
plugin-dir=/usr/local/mysql/lib/plugin
user=\_mysql
log-bin=mysql-bin
port=3306
server-id=1
</code></pre><p>再次启动mysql，成功了！但是有个问题，mysql 的日志直接输出在控制台中，需要输出到指定文件夹中，在 <code>/etc/my.cnf</code> 的 <code>[mysqld]</code> 中增加配置</p>
<pre><code>log-error=/usr/local/mysql/data/local.err
</code></pre><p>我们开启了binlog之后，可以使用 <code>mysqlbinlog</code> 来查看binlog了！<br>回到第一个问题 <em><em>binlog file name 从哪来？</em></em></p>
<pre><code>mysql&gt; show master status;

+------------------+-----------+--------------+------------------+-------------------------------------------------+
| File             | Position  | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                               |
+------------------+-----------+--------------+------------------+-------------------------------------------------+
| mysql-bin.000065 | 516819919 |              |                  | 63c58e9d-e063-11e6-8a0e-6c92bf324c90:1-19804498 |
+------------------+-----------+--------------+------------------+-------------------------------------------------+
1 row in set (0.00 sec)
</code></pre><p>这里第一列就是 binlog 日志文件的名称了！</p>
<pre><code>mysqlbinlog
-?, --help          Display this help and exit.
                    查看帮助信息
--base64-output=name
                    Determine when the output statements should be
                    base64-encoded BINLOG statements: &apos;never&apos; disables it and
                    works only for binlogs without row-based events;
                    &apos;decode-rows&apos; decodes row events into commented
                    pseudo-SQL statements if the --verbose option is also
                    given; &apos;auto&apos; prints base64 only when necessary (i.e.,
                    for row-based events and format description events).  If
                    no --base64-output[=name] option is given at all, the
                    default is &apos;auto&apos;.
--bind-address=name IP address to bind to.
--character-sets-dir=name
                    Directory for character set files.
-d, --database=name 指明查询binlog 的数据库，如：-dtest，查看test 数据库
--rewrite-db=name   Rewrite the row event to point so that it can be applied
                    to a new database
-#, --debug[=#]     This is a non-debug version. Catch this and exit.
--debug-check       This is a non-debug version. Catch this and exit.
--debug-info        This is a non-debug version. Catch this and exit.
--default-auth=name Default authentication client-side plugin to use.
-D, --disable-log-bin
                    Disable binary log. This is useful, if you enabled
                    --to-last-log and are sending the output to the same
                    MySQL server. This way you could avoid an endless loop.
                    You would also like to use it when restoring after a
                    crash to avoid duplication of the statements you already
                    have. NOTE: you will need a SUPER privilege to use this
                    option.
-F, --force-if-open Force if binlog was not closed properly.
                    (Defaults to on; use --skip-force-if-open to disable.)
-f, --force-read    Force reading unknown binlog events.
-H, --hexdump       Augment output with hexadecimal and ASCII event dump.
-h, --host=name     Get the binlog from server.
-i, --idempotent    Notify the server to use idempotent mode before applying
                    Row Events
-l, --local-load=name
                    Prepare local temporary files for LOAD DATA INFILE in the
                    specified directory.
-o, --offset=#      Skip the first N entries.
-p, --password[=name]
                    Password to connect to remote server.
--plugin-dir=name   Directory for client-side plugins.
-P, --port=#        Port number to use for connection or 0 for default to, in
                    order of preference, my.cnf, $MYSQL_TCP_PORT,
                    /etc/services, built-in default (3306).
--protocol=name     The protocol to use for connection (tcp, socket, pipe,
                    memory).
-R, --read-from-remote-server
                    Read binary logs from a MySQL server. This is an alias
                    for read-from-remote-master=BINLOG-DUMP-NON-GTIDS.
--read-from-remote-master=name
                    Read binary logs from a MySQL server through the
                    COM_BINLOG_DUMP or COM_BINLOG_DUMP_GTID commands by
                    setting the option to either BINLOG-DUMP-NON-GTIDS or
                    BINLOG-DUMP-GTIDS, respectively. If
                    --read-from-remote-master=BINLOG-DUMP-GTIDS is combined
                    with --exclude-gtids, transactions can be filtered out on
                    the master avoiding unnecessary network traffic.
--raw               Requires -R. Output raw binlog data instead of SQL
                    statements, output is to log files.
-r, --result-file=name
                    Direct output to a given file. With --raw this is a
                    prefix for the file names.
--secure-auth       Refuse client connecting to server if it uses old
                    (pre-4.1.1) protocol. Deprecated. Always TRUE
--server-id=#       Extract only binlog entries created by the server having
                    the given id.
--server-id-bits=#  Set number of significant bits in server-id
--set-charset=name  Add &apos;SET NAMES character_set&apos; to the output.
-s, --short-form    Just show regular queries: no extra info and no row-based
                    events. This is for testing only, and should not be used
                    in production systems. If you want to suppress
                    base64-output, consider using --base64-output=never
                    instead.
-S, --socket=name   The socket file to use for connection.
--ssl-mode=name     SSL connection mode.
--ssl               Deprecated. Use --ssl-mode instead.
                    (Defaults to on; use --skip-ssl to disable.)
--ssl-verify-server-cert
                    Deprecated. Use --ssl-mode=VERIFY_IDENTITY instead.
--ssl-ca=name       CA file in PEM format.
--ssl-capath=name   CA directory.
--ssl-cert=name     X509 cert in PEM format.
--ssl-cipher=name   SSL cipher to use.
--ssl-key=name      X509 key in PEM format.
--ssl-crl=name      Certificate revocation list.
--ssl-crlpath=name  Certificate revocation list path.
--tls-version=name  TLS version to use, permitted values are: TLSv1, TLSv1.1
--start-datetime=name
                    Start reading the binlog at first event having a datetime
                    equal or posterior to the argument; the argument must be
                    a date and time in the local time zone, in any format
                    accepted by the MySQL server for DATETIME and TIMESTAMP
                    types, for example: 2004-12-25 11:25:56 (you should
                    probably use quotes for your shell to set it properly).
-j, --start-position=#
                    Start reading the binlog at position N. Applies to the
                    first binlog passed on the command line.
--stop-datetime=name
                    Stop reading the binlog at first event having a datetime
                    equal or posterior to the argument; the argument must be
                    a date and time in the local time zone, in any format
                    accepted by the MySQL server for DATETIME and TIMESTAMP
                    types, for example: 2004-12-25 11:25:56 (you should
                    probably use quotes for your shell to set it properly).
--stop-never        Wait for more data from the server instead of stopping at
                    the end of the last log. Implicitly sets --to-last-log
                    but instead of stopping at the end of the last log it
                    continues to wait till the server disconnects.
--stop-never-slave-server-id=#
                    The slave server_id used for --read-from-remote-server
                    --stop-never. This option cannot be used together with
                    connection-server-id.
--connection-server-id=#
                    The slave server_id used for --read-from-remote-server.
                    This option cannot be used together with
                    stop-never-slave-server-id.
--stop-position=#   Stop reading the binlog at position N. Applies to the
                    last binlog passed on the command line.
-t, --to-last-log   Requires -R. Will not stop at the end of the requested
                    binlog but rather continue printing until the end of the
                    last binlog of the MySQL server. If you send the output
                    to the same MySQL server, that may lead to an endless
                    loop.
-u, --user=name     链接数据库的用户名
-v, --verbose       Reconstruct pseudo-SQL statements out of row events. -v
                    -v adds comments on column data types.
-V, --version       查看 `mysqlbinlog` 版本信息
--open-files-limit=#
                    Used to reserve file descriptors for use by this program.
-c, --verify-binlog-checksum
                    Verify checksum binlog events.
--binlog-row-event-max-size=#
                    The maximum size of a row-based binary log event in
                    bytes. Rows will be grouped into events smaller than this
                    size if possible. This value must be a multiple of 256.
--skip-gtids        Do not preserve Global Transaction Identifiers; instead
                    make the server execute the transactions as if they were
                    new.
--include-gtids=name
                    打印binlog 信息时，只打印指定的部分全局事务id对应的binglog 信息
--exclude-gtids=name
                    打印binlog 信息时，排除部分全局事务id对应的binglog 信息
</code></pre><h4 id="待解决问题"><a href="#待解决问题" class="headerlink" title="待解决问题"></a>待解决问题</h4><p>如果在 mac os 的设置中启动了mysql 而且勾选了 <code>Automatically Start MySQL Server on Startup</code>, 当你想要关闭 mysql 的时候，mysql 会自动重启！！！<br>这个问题找了好久才发现，至于这个不断重启功能的实现待研究…</p>
<h3 id="mysql-查看存储过程"><a href="#mysql-查看存储过程" class="headerlink" title="mysql 查看存储过程"></a>mysql 查看存储过程</h3><h4 id="查看存储过程状态"><a href="#查看存储过程状态" class="headerlink" title="查看存储过程状态"></a>查看存储过程状态</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">procedure</span> <span class="keyword">status</span>;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<pre><code>mysql&gt; show procedure status\G
*************************** 1. row ***************************
              Db: db_name
            Name: procedure_name
            Type: PROCEDURE
         Definer: root@localhost
        Modified: 2017-05-10 14:10:00
         Created: 2017-05-10 14:10:00
   Security_type: DEFINER
         Comment:
character_set_client: utf8mb4
collation_connection: utf8mb4_general_ci
Database Collation: utf8_general_ci
1 row in set (0.02 sec)
</code></pre><h4 id="查看存储过程具体定义"><a href="#查看存储过程具体定义" class="headerlink" title="查看存储过程具体定义"></a>查看存储过程具体定义</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">procedure</span> %procedure_name%;</span><br></pre></td></tr></table></figure>
<h4 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> &#123;<span class="keyword">PROCEDURE</span> | <span class="keyword">FUNCTION</span>&#125; [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] sp_name</span><br></pre></td></tr></table></figure>

        
        <div id="comment-container">
        </div>
    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</html>
